function setActiveStyleSheet(e){var t,o;for(t=0;o=document.getElementsByTagName("link")[t];t++)-1!==o.getAttribute("rel").indexOf("style")&&o.getAttribute("title")&&(o.disabled=!0,o.getAttribute("title")===e&&(o.disabled=!1))}function getActiveStyleSheet(){var e,t;for(e=0;t=document.getElementsByTagName("link")[e];e++)if(-1!==t.getAttribute("rel").indexOf("style")&&t.getAttribute("title")&&!t.disabled)return t.getAttribute("title");return null}function getPreferredStyleSheet(){var e,t;for(e=0;t=document.getElementsByTagName("link")[e];e++)if(-1!==t.getAttribute("rel").indexOf("style")&&-1===t.getAttribute("rel").indexOf("alt")&&t.getAttribute("title"))return t.getAttribute("title");return null}function createCookie(e,t,o){if(o){var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);var s="; expires="+n.toGMTString()}else s="";document.cookie=e+"="+t+s+"; path=/"}function readCookie(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var s=o[n];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return s.substring(t.length,s.length)}return null}!function(){var e=angular.module("cloneIT",[]),t="",o="";e.controller("UserController",["$scope","ajaxRequest","sharedProperties",function(e,n,s){e.user={},e.remember={},self=this,self.checkLogin=function(r){t=s.getItems(),o=s.getUserId();var i=($.cookie("user"),$.cookie("password"),$.cookie("session")),a={};if("autologin"==r&&i)a.session=i;else{if("userlogin"!=r)return;a.login=e.user.login,a.password=e.user.password,a.remember=e.user.remember,a.session=i,$(".big-nav input").removeClass("ng-dirty"),e.user.login="",e.user.password=""}n.post("/checklogin",a,function(n){n&&(e.user.firstname=n.firstname,e.user.lastname=n.lastname,e.user.image=n.image,sessionStorage.setItem("posts",JSON.stringify(n.posts)),sessionStorage.setItem("upvotes",JSON.stringify(n.upvotes)),sessionStorage.setItem("downvotes",JSON.stringify(n.downvotes)),o=n._id,s.setUserId(o),$("body").removeClass("not-logged-in"),$("form.new-form").removeClass("hidden"),n.upvotes.forEach(function(e){t.forEach(function(t){t._id===e&&(t.upvoteclass="is-upvoted")})}),n.downvotes.forEach(function(e){t.forEach(function(t){t._id===e&&(t.downvoteclass="is-downvoted")})}),n.posts.forEach(function(e){t.forEach(function(t){t._id===e&&(t.publisherclass="is-publisher")})}))})},e.newUser={},self.signup=function(){var t={},o=Math.floor(5*Math.random())+1;t.username=e.newUser.username,t.email=e.newUser.email,t.firstname=e.newUser.firstname,t.lastname=e.newUser.lastname,t.password=e.newUser.password,t.image="images/portrait"+o+".png",t.createdOn=Date.now(),n.post("/newuser",t,function(t){"user-added-successfully"===t[0]?(e.user=t[1],e.newUser="",$(".big-nav input").removeClass("ng-dirty")):"already-taken"===t[0]&&(e.newUser.username="")})},setTimeout(function(){self.checkLogin("autologin")},100)}])}(),function(){angular.module("cloneIT").controller("ActionsController",["$scope","ajaxRequest","sharedProperties","sessionStore",function(e,t,o,n){var s="",r="",i="",a="",u="",d="",c="";e.voteUp=function(e,i){a=o.getSessionUpvotes(),u=o.getSessionDownvotes(),d=a.indexOf(e)>-1,c=u.indexOf(e)>-1;var l=$(i.currentTarget),p=l.closest("ul").find('a[data-function="downvote"]');if(s=o.getItems(),r=o.getUserId(),!d&&c){var f=$.grep(s,function(t){return t._id==e})[0];f.downvotes=f.downvotes-1,p.removeClass("is-downvoted"),n.removeDownvote(e),t.update("/remove-downvote",e),t.updateUserDownvote("/remove-downvote-by-user",e,r),g=$.grep(s,function(t){return t._id==e})[0],g.upvotes=g.upvotes+1,$(i.currentTarget).addClass("is-upvoted"),n.addUpvote(e),t.update("/upvote",e),t.updateUserUpvote("/upvote-by-user",e,r)}else if(d)g=$.grep(s,function(t){return t._id==e})[0],g.upvotes=g.upvotes-1,$(i.currentTarget).removeClass("is-upvoted"),n.removeUpvote(e),t.update("/remove-upvote",e),t.updateUserUpvote("/remove-upvote-by-user",e,r);else if($("body").hasClass("not-logged-in"))alert("Please log in to vote on this post");else{var g=$.grep(s,function(t){return t._id==e})[0];g.upvotes=g.upvotes+1,$(i.currentTarget).addClass("is-upvoted"),n.addUpvote(e),t.update("/upvote",e),t.updateUserUpvote("/upvote-by-user",e,r)}},e.voteDown=function(e,i){var l=$(i.currentTarget),p=l.closest("ul").find('a[data-function="upvote"]');if(s=o.getItems(),r=o.getUserId(),a=o.getSessionUpvotes(),u=o.getSessionDownvotes(),d=a.indexOf(e)>-1,c=u.indexOf(e)>-1,!c&&d){var f=$.grep(s,function(t){return t._id==e})[0];f.upvotes=f.upvotes-1,p.removeClass("is-upvoted"),n.removeUpvote(e),t.update("/remove-upvote",e),t.updateUserDownvote("/remove-upvote-by-user",e,r);var g=$.grep(s,function(t){return t._id==e})[0];g.downvotes=g.downvotes+1,l.addClass("is-downvoted"),n.addDownvote(e),t.update("/downvote",e),t.updateUserUpvote("/downvote-by-user",e,r)}else c?(g=$.grep(s,function(t){return t._id==e})[0],g.downvotes=g.downvotes-1,$(i.currentTarget).removeClass("is-downvoted"),n.removeDownvote(e),t.update("/remove-downvote",e),t.updateUserDownvote("/remove-downvote-by-user",e,r)):$("body").hasClass("not-logged-in")?alert("Please log in to vote on this post"):(g=$.grep(s,function(t){return t._id==e})[0],g.downvotes=g.downvotes+1,$(i.currentTarget).addClass("is-downvoted"),$(i.currentTarget).addClass("is-downvoted"),n.addDownvote(e),t.update("/downvote",e),t.updateUserDownvote("/downvote-by-user",e,r))},e.erase=function(e,r){i=o.getSessionPosts(),i.indexOf(e)>-1&&(s=o.getItems(),s.splice(r,1),o.setItems(s),setTimeout(function(){$("#container").isotope("reloadItems").isotope({sortBy:"original-order"})},10),n.removePost(e),t.update("/remove",e))},e.showComments=function(e){if(e.currentTarget.parentElement.innerText>0||!$(".new-form").hasClass("hidden")){var t=$(e.currentTarget).closest(".post").find(".comments-container");"block"==t.css("display")?(t.hide(200,function(){$("#container").isotope("reloadItems").isotope({sortBy:"original-order"})}),t.css("display","none")):($(".comments-container").hide(200),t.show(200,function(){$("#container").isotope("reloadItems").isotope({sortBy:"original-order"})}))}},e.postComment=function(o){newComment=e.actionsCtrl.newComment,postId=o._id,o.comments.push(newComment),o.commented=o.commented+1,setTimeout(function(){$("#container").isotope("reloadItems").isotope({sortBy:"original-order"})},100),e.actionsCtrl.newComment="",$(".comment-box input").removeClass("ng-dirty"),t.update("/newcomment",postId,newComment)},e.toggleLogin=function(){$(".big-nav").toggle(300)},e.toggleNavigation=function(){$(".big-nav").toggle(300);var e=$(".show-new-link"),t=e.text();e.text("Add new link"===t?"Close":"Add new link")},e.logout=function(){s=o.getItems(),$(".goodbye-msg").show(0).delay(3e3).fadeOut(150).hide(0),$(".header_logged-in").hide(500),$(".header_logged-out").show(500),$(".big-nav").delay(3e3).toggle(400),$(".show-new-link").text("Add new link"),$(".is-upvoted").removeClass("is-upvoted"),$(".is-downvoted").removeClass("is-downvoted"),$("form.new-form").addClass("hidden"),$("body").addClass("not-logged-in"),e.user.password="",t.update("/logout"),s.forEach(function(e){e.publisherclass="",e.upvoteclass="",e.downvoteclass="",e.newpostclass=""}),sessionStorage.removeItem("posts"),sessionStorage.removeItem("upvotes"),sessionStorage.removeItem("downvotes")},e.showSignup=function(){$(".header_logged-out").hide(500),$(".header_sign-up").show(500)},e.closeSignup=function(){$(".header_logged-out").show(500),$(".header_sign-up").hide(500)}}])}(),function(){angular.module("cloneIT").controller("NewPostController",["$scope","$http","ajaxRequest","sharedProperties","sessionStore",function(e,t,o,n,s){var r="";e.newPostCtrl={};var i={};e.tags=[{tag:"Fun"},{tag:"Scary"},{tag:"Movies"},{tag:"Games"},{tag:"Nature"}],e.addPost=function(){i={},i.title=e.newPostCtrl.title,i.url=e.newPostCtrl.url,i.tag=e.newPostCtrl.tag.tag,i.imgurl="images/bunny.png",i.upvotes=0,i.downvotes=0,i.commented=0,i.creadtedBy=r=n.getUserId(),i.createdOn=Date.now(),i.comments=[],i.newpostclass="is-new",e.newPostCtrl={},$(".big-nav input").removeClass("ng-dirty"),o.post("/addpost",i,function(e){i._id=e._id,o.updateUserPost("/post-by-user",i._id,r),s.addPost(i._id)}),n.addItem(i),setTimeout(function(){$("#container").isotope("reloadItems").isotope({sortBy:"original-order"})},100)}}])}(),function(){angular.module("cloneIT").controller("PostController",["$http","$filter","ajaxRequest","filterFilter","sharedProperties",function(e,t,o,n,s){var r="",i=this;o.get("/posts",function(e){e.forEach(function(e){e.newpostclass&&(e.newpostclass="")}),e&&(r=i.posts=e,s.setItems(r),setTimeout(function(){$("#container").isotope("reloadItems").isotope({sortBy:"original-order"})},10))}),this.filter=function(e,t){t.preventDefault(),this.posts=r,this.posts=n(this.posts,{tag:e}),setTimeout(function(){$("#container").isotope("reloadItems").isotope({sortBy:"original-order"})},10)},this.order=function(e,o){o.preventDefault(),i.posts="date"==e?t("orderBy")(i.posts,"-createdOn"):t("orderBy")(i.posts,"-upvotes"),setTimeout(function(){$("#container").isotope("reloadItems").isotope({sortBy:"original-order"})},10)}}])}();var app=angular.module("cloneIT");app.service("ajaxRequest",["$http","loginHandler",function(e,t){this.get=function(t,o){return e.get(t).success(function(e){o(e)})},this.post=function(o,n,s){e.post(o,n).success(function(e){switch(e.newPost?s(e):e.username?(t.correct(e),s(e)):"user-added-successfully"===e[0]?(t.correct(e),s(e)):"already-taken"===e[0]&&(t.taken(e),s(e)),e){case"wrong":t.wrong();break;case"not-found":t.notFound();break;case"error":t.error();break;case"unknown":t.unknown()}})},this.update=function(t,o,n){e.post(t,{_id:o,newComment:n}).success(function(e){})},this.updateUserUpvote=function(t,o,n){e.post(t,{postId:o,userId:n}).success(function(e){})},this.updateUserDownvote=function(t,o,n){e.post(t,{postId:o,userId:n}).success(function(e){})},this.updateUserPost=function(t,o,n){e.post(t,{postId:o,userId:n}).success(function(e){})},this.remove=function(t,o){e.delete(t).success(function(e){})}}]);var app=angular.module("cloneIT");app.service("loginHandler",[function(){this.correct=function(){$(".header_logged-in").show(500),$(".header_logged-out").hide(500),$(".header_sign-up").hide(500),$(".welcome-msg").show(0).delay(3e3).fadeOut(150),$(".big-nav").delay(3e3).hide(500)},this.taken=function(){$(".taken-msg").removeClass("hidden").fadeOut(0).fadeIn(250).delay(3e3).fadeOut(1e3)},this.wrong=function(){alert("Try again, you can do better!")},this.notFound=function(){alert("Sorry, no user found with this user name :(")},this.error=function(){},this.unknown=function(){}}]);var app=angular.module("cloneIT");app.service("sessionStore",function(){return{addPost:function(e){var t=JSON.parse(sessionStorage.getItem("posts"));t.push(e),sessionStorage.setItem("posts",JSON.stringify(t))},removePost:function(e){var t=JSON.parse(sessionStorage.getItem("posts")),o=t.indexOf(e);o>-1&&t.splice(o,1),sessionStorage.setItem("posts",JSON.stringify(t))},addUpvote:function(e){var t=JSON.parse(sessionStorage.getItem("upvotes"));t.push(e),sessionStorage.setItem("upvotes",JSON.stringify(t))},removeUpvote:function(e){var t=JSON.parse(sessionStorage.getItem("upvotes")),o=t.indexOf(e);o>-1&&t.splice(o,1),sessionStorage.setItem("upvotes",JSON.stringify(t))},addDownvote:function(e){var t=JSON.parse(sessionStorage.getItem("downvotes"));t.push(e),sessionStorage.setItem("downvotes",JSON.stringify(t))},removeDownvote:function(e){var t=JSON.parse(sessionStorage.getItem("downvotes")),o=t.indexOf(e);o>-1&&t.splice(o,1),sessionStorage.setItem("downvotes",JSON.stringify(t))}}});var app=angular.module("cloneIT");app.service("sharedProperties",function(){var e="",t="";return{getUserId:function(){return e},setUserId:function(t){e=t},getItems:function(){return t},setItems:function(e){t=e},addItem:function(e){t.unshift(e)},getSessionPosts:function(){return JSON.parse(sessionStorage.posts)},getSessionUpvotes:function(){return JSON.parse(sessionStorage.upvotes)},getSessionDownvotes:function(){return JSON.parse(sessionStorage.downvotes)}}}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return a.raw?e:encodeURIComponent(e)}function o(e){return a.raw?e:decodeURIComponent(e)}function n(e){return t(a.json?JSON.stringify(e):String(e))}function s(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(i," ")),a.json?JSON.parse(e):e}catch(t){}}function r(t,o){var n=a.raw?t:s(t);return e.isFunction(o)?o(n):n}var i=/\+/g,a=e.cookie=function(s,i,u){if(arguments.length>1&&!e.isFunction(i)){if(u=e.extend({},a.defaults,u),"number"==typeof u.expires){var d=u.expires,c=u.expires=new Date;c.setTime(+c+864e5*d)}return document.cookie=[t(s),"=",n(i),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join("")}for(var l=s?void 0:{},p=document.cookie?document.cookie.split("; "):[],f=0,g=p.length;g>f;f++){var v=p[f].split("="),m=o(v.shift()),w=v.join("=");if(s&&s===m){l=r(w,i);break}s||void 0===(w=r(w))||(l[m]=w)}return l};a.defaults={},e.removeCookie=function(t,o){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},o,{expires:-1})),!e.cookie(t))}}),function(e){e(document).ready(function(){e(".salmon").on("click",function(e){e.preventDefault(),setActiveStyleSheet("default")}),e(".usa").on("click",function(e){e.preventDefault(),setActiveStyleSheet("usa")}),e(".marine").on("click",function(e){e.preventDefault(),setActiveStyleSheet("marine")})});var t=e("#container");t.isotope({itemSelector:".item",masonry:{columnWidth:".masonry-width"}})}(jQuery),window.onload=function(){var e=readCookie("style"),t=e?e:getPreferredStyleSheet();setActiveStyleSheet(t)},window.onunload=function(){var e=getActiveStyleSheet();createCookie("style",e,365)};var cookie=readCookie("style"),title=cookie?cookie:getPreferredStyleSheet();setActiveStyleSheet(title),$(".salmon").on("click",function(e){e.preventDefault(),setActiveStyleSheet("default")}),$(".usa").on("click",function(e){e.preventDefault(),setActiveStyleSheet("usa")}),$(".marine").on("click",function(e){e.preventDefault(),setActiveStyleSheet("marine")});